<div class="main">
    <div class="title">
        <h3>Invoice Creation</h3>
    </div>
    <mat-radio-group class="tp-radio-group" [(ngModel)]="selectedInvoiceType"
        *ngIf="isSelectedInvoiceTypeVisible == true" style="margin-top: 1em;">
        <mat-radio-button class="tp-radio-button" value="po" (change)="onInvoiceTypeChange($event)"
            style="margin-right: 1em;">
            PO Invoice
        </mat-radio-button>
        <mat-radio-button class="tp-radio-button" value="non-po" (change)="onInvoiceTypeChange($event)">
            Non PO Invoice
        </mat-radio-button>
    </mat-radio-group>

    <form [formGroup]="invoiceUploadForm">
        <div class="search-row">
            <mat-form-field class="search-row-element" *ngIf="selectedInvoiceType == 'po'">
                <mat-label>Choose PO No.</mat-label>
                <mat-select matNativeControl formControlName="poList">
                    <mat-option *ngFor="let p of poList" [value]="p.poNumber">
                        {{ p.poNumber }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="search-row-element">
                <mat-label>Invoice No.</mat-label>
                <input type="text" matInput formControlName="invoiceNumber" autocomplete="off">
            </mat-form-field>

            <mat-form-field class="search-row-element date">
                <mat-label>Invoice Date</mat-label>
                <input matInput [matDatepicker]="picker" disabled formControlName="invoiceDate" autocomplete="off">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker disabled="false"></mat-datepicker>
            </mat-form-field>

            <mat-form-field class="search-row-element remarks">
                <mat-label>Remarks</mat-label>
                <input type="text" matInput placeholder="Remarks" formControlName="remarks" autocomplete="off">
            </mat-form-field>

            <mat-form-field class="search-row-elemen currency" *ngIf="selectedInvoiceType == 'non-po'">
                <mat-label>Choose Currency</mat-label>
                <mat-select matNativeControl formControlName="currency">
                    <mat-option *ngFor="let c of currencyList" [value]="c.currencyCode">
                        {{ c.currencyDesc }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <div class=" search-row-element actions" *ngIf="selectedInvoiceType == 'non-po'">
                <button mat-raised-button class="footer-actions footer-actions-green" (click)="onNewClick()">New</button>
            </div>
        </div>
       
        <!-- table details -->
        <div class="container my-container margin-unset full-width">
            <table class="dataTable full-width">
                <thead>
                    <tr>
                        <th class="headers" scope="col" *ngFor="let col of headerArr; let hInd = index">
                            <span>{{ headerArr[hInd] }} </span>
                        </th>
                    </tr>
                </thead>
                <tbody formArrayName="itemsList">
                    <tr *ngFor="let item of invoiceUploadForm.get('itemsList')?.controls; let itemInd = index"
                        [formGroupName]="itemInd">
                        <td>
                            <span *ngIf="selectedInvoiceType == 'po'">{{ item.get("itemNumber").value }}</span>
                            <input *ngIf="selectedInvoiceType == 'non-po'" class="inv-qty" formControlName="itemNumber">
                        </td>
                        <td>
                            <span *ngIf="selectedInvoiceType == 'po'">{{ item.get("itemDescription").value }}</span>
                            <input *ngIf="selectedInvoiceType == 'non-po'" class="inv-qty"
                                formControlName="itemDescription">
                        </td>
                        <td>
                            <input class="inv-qty" formControlName="hsn">
                        </td>
                        <td *ngIf="selectedInvoiceType == 'po'">
                            <span>{{ item.get("orderedUnits").value }}</span>
                        </td>
                        <td *ngIf="selectedInvoiceType == 'po'">
                            <span>{{ item.get("suppliedUnits").value }}</span>
                        </td>
                        <td *ngIf="selectedInvoiceType == 'po'">
                            <span>{{ item.get("consumedUnits").value }}</span>
                        </td>
                        <td>
                            <input class="inv-qty" formControlName="invoiceUnits" (blur)="onInvoiceUnitsBlur(itemInd)">
                        </td>
                        <td *ngIf="selectedInvoiceType == 'po'">
                            <span>{{ currency }}</span>
                        </td>
                        <td class="amount">
                            <span *ngIf="selectedInvoiceType == 'po'"
                                (blur)="onInvoiceUnitsBlur(itemInd)">{{ item.get("unitPrice").value }}</span>
                            <input *ngIf="selectedInvoiceType == 'non-po'" class="inv-qty" formControlName="unitPrice">
                        </td>
                        <td class="amount">
                            {{ item.get("unitsAmt").value }}
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="dataTable full-width">
                <tbody>
                    <tr>
                        <td class="add-ons"> Invoice Net Amount
                        </td>
                        <td style="margin-left: 10px" class="amount">
                            {{ f["totalItemsAmt"].value + " " + currency }}
                        </td>
                    </tr>
                    <tr>
                        <td class="add-ons"> Freight Amount
                        </td>
                        <td style="margin-left: 10px" class="amount">
                            <span>
                                <input class="inv-qty" formControlName="freightCharges"
                                    (blur)="updateInvoiceTotalAmt()">
                                <span style="margin-left: 10px">{{ currency }}</span>
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td class="add-ons"> Total Tax Amount
                        </td>
                        <td style="margin-left: 10px" class="amount">
                            <span>
                                <input class="inv-qty" formControlName="totalTax" (blur)="updateInvoiceTotalAmt()">
                                <span style="margin-left: 10px">{{ currency }}</span>
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td class="add-ons"> Invoice Total Amount
                        </td>
                        <td style="margin-left: 10px" class="amount">
                            {{ f["totalInvAmt"].value + " " + currency }}
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="actions attachment-row">
                <div class="attachment-elements" style="font-weight: bold">
                    Invoice Attachments
                </div>
                <input class="attachment-elements" style="display: none" [attr.id]="'invoiceFileCtrl'" type="file"
                    multiple accept=".xls,.xlsx,.doc,.docx,.pdf,.png,.jpg,.zip"
                    (change)="onInvoiceFileChange($event)" />
                <button mat-raised-button class="footer-actions attachment-elements"
                    (click)="onInvoiceBrowseClick($event)">Browse</button>
                <button mat-raised-button class="footer-actions  attachment-elements"
                    (click)="onInvoiceAttachFileClick()">Attach</button>
                <div class="filename attachment-elements" *ngFor="let f of invoiceFilesList; let fInd = index" >
                    <span>
                        {{ f.actualFileName }}
                        <button mat-button mat-icon-button aria-label="Delete" (click) = "onDeleteFileClick(f, fInd, 'invoice')">
                            <mat-icon>delete_outline</mat-icon>
                        </button>
                        <button *ngIf = "f.fileId != null" mat-button mat-icon-button aria-label="Download" (click) = "downloadFile(f)">
                            <mat-icon>save_alt</mat-icon>
                        </button>
                    </span>
                </div>
            </div>
            <div class="actions attachment-row">

                <div class="attachment-elements" style="font-weight: bold">
                    Supporting Document Attachments
                </div>
                <input class="attachment-elements" style="display: none" [attr.id]="'supportingFileCtrl'" type="file"
                    multiple accept=".xls,.xlsx,.doc,.docx,.pdf,.png,.jpg,.zip"
                    (change)="onSupportingFileChange($event)" />
                <button mat-raised-button class="footer-actions attachment-elements"
                    (click)="onSupportingBrowseClick($event)">Browse</button>
                <button mat-raised-button class="footer-actions  attachment-elements"
                    (click)="onSupportingAttachFileClick()">Attach</button>
                <div class="filename attachment-elements" *ngFor="let f of supportingFilesList; let fInd = index">
                    <span>
                        {{ f.actualFileName }}
                        <button mat-button mat-icon-button aria-label="Delete" (click) = "onDeleteFileClick(f, fInd, 'support')">
                            <mat-icon>delete_outline</mat-icon>
                        </button>
                        <button *ngIf = "f.fileId != null" mat-button mat-icon-button aria-label="Download" (click) = "downloadFile(f)">
                            <mat-icon>save_alt</mat-icon>
                        </button>
                    </span>
                </div>

            </div>
         
            <div class="row actions margin-unset">
                <div class="error-txt">
                    {{ msg }}
                </div>
                <button mat-raised-button class="footer-actions">Cancel</button>
                <button mat-raised-button class="footer-actions" (click)="onSubmitClick()">Submit</button>
                <button mat-raised-button class="footer-actions footer-actions-green"
                    (click)="onSaveClick()">Save</button>
            </div>

        </div>
    </form>
</div>